{% extends 'partials/base.html' %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Dashboard</h1>

    <!-- Overview Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-white bg-primary">
                <div class="card-header">Total Products</div>
                <div class="card-body">
                    <h5 class="card-title">{{ total_products }}</h5>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-success">
                <div class="card-header">Total Categories</div>
                <div class="card-body">
                    <h5 class="card-title">{{ total_categories }}</h5>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-info">
                <div class="card-header">Total Transactions</div>
                <div class="card-body">
                    <h5 class="card-title">{{ total_transactions }}</h5>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-danger">
                <div class="card-header">Low Stock Items</div>
                <div class="card-body">
                    <h5 class="card-title">{{ low_stock_items }}</h5>
                </div>
            </div>
        </div>
    </div>

    <!-- Stock Level Chart -->
    <div class="card mb-4">
        <div class="card-header">Stock Levels</div>
        <div class="card-body">
            <canvas id="stockChart" height="100"></canvas>
        </div>
    </div>

    <!-- Recent Stock Transactions -->
    <div class="card mb-4">
        <div class="card-header">Recent Stock Transactions</div>
        <div class="card-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Reference Number</th>
                        <th>Product</th>
                        <th>Transaction Type</th>
                        <th>Quantity</th>
                        <th>Performed By</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for transaction in recent_transactions %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ transaction.reference_number }}</td>
                        <td>{{ transaction.product.name }}</td>
                        <td>
                            {% if transaction.transaction_type == "ADD" %}
                            <span class="text-success">Added</span>
                            {% else %}
                            <span class="text-danger">Removed</span>
                            {% endif %}
                        </td>
                        <td>{{ transaction.quantity }}</td>
                        <td>{{ transaction.performed_by }}</td>
                        <td>{{ transaction.timestamp|date:"M d, Y" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <a href="{% url 'dashboard-stock-transactions' %}" class="btn btn-primary mt-2">View All Transactions</a>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="card mb-4">
        <div class="card-header">Quick Actions</div>
        <div class="card-body">
            <a href="{% url 'add-product' %}" class="btn btn-primary">Add Product</a>
            <a href="{% url 'add-stock-transaction' %}" class="btn btn-success">Add Stock Transaction</a>
            <a href="{% url 'dashboard-stock-transactions' %}" class="btn btn-info">View Transactions</a>
            <a href="{% url 'low-stock-items' %}" class="btn btn-danger">View Low Stock Items</a>
        </div>
    </div>
</div>
{% endblock %}

<script>
    var ctx = document.getElementById('stockChart').getContext('2d');
    var stockChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: {{ product_names|safe }},
            datasets: [{
                label: 'Stock Levels',
                data: {{ product_stock_levels|safe }},
                backgroundColor: {{ stock_colors|safe }}
            }]
        },
        options: {
            responsive: true,
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });
</script>

